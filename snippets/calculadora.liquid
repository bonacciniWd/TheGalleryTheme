<script>
  document.getElementById('form-calculadora-frete').addEventListener('submit', function(e) {
    e.preventDefault();
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    const variant = {{ product.selected_or_first_available_variant | json }};

    const payload = {
      SellerCEP: "88338270", // Ex: "01001000"
      RecipientCEP: cep,
      ShipmentInvoiceValue: variant.price / 100,
      ShippingItemArray: [{
        Height: variant.height || 10,
        Length: variant.length || 10,
        Width: variant.width || 10,
        Weight: variant.weight / 1000 || 1,
        Quantity: 1
      }]
    };

    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'https://SEU_PROXY_NO_VERCEL.vercel.app/api/frenet', true);
    xhr.setRequestHeader('Content-Type', 'application/json');

    xhr.onload = function() {
      const resultadoFrete = document.getElementById('resultado-frete');
      if (xhr.status === 200) {
        const data = JSON.parse(xhr.responseText);
        if (data.ShippingSevicesArray && data.ShippingSevicesArray.length > 0) {
          let html = '<ul>';
          data.ShippingSevicesArray.forEach(service => {
            html += `<li>${service.ServiceDescription}: R$ ${service.ShippingPrice.toFixed(2)}</li>`;
          });
          html += '</ul>';
          resultadoFrete.innerHTML = html;
        } else {
          resultadoFrete.innerHTML = 'Nenhum frete dispon√≠vel.';
        }
      } else {
        resultadoFrete.innerHTML = 'Erro ao calcular frete.';
      }
    };

    xhr.send(JSON.stringify(payload));
  });
</script>
