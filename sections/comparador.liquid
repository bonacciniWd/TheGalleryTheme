{% comment %}
  Seção de Comparação de Imagens com Slider de Fundo
  Baseado no código fornecido, utilizando background-image e um input type="range".
{% endcomment %}

<style>
  /* Estilos para a seção principal */
  .section-image-comparison-background-slider-{{ section.id }} {
    position: relative;
    width: 100%;
    max-width: {{ section.settings.max_width }}px;
    margin: 2rem auto; /* Adiciona margem para melhor visualização */
    background-color: {{ section.settings.background_color }};
    padding: 2rem 0;
    box-sizing: border-box;
    font-family: sans-serif; /* Ou sua fonte de tema padrão */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Título da seção (opcional) */
  .image-comparison-background-slider-heading-{{ section.id }} {
    color: {{ section.settings.text_color }};
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  /* Container principal da comparação */
  #comparison-{{ section.id }} {
    width: 100%; /* Ocupa a largura total da seção (até max_width) */
    /* Calcula a altura com base no aspect ratio para imagens responsivas */
    padding-top: {{ 100 | divided_by: section.settings.aspect_ratio }}%;
    max-width: {{ section.settings.max_width }}px;
    overflow: hidden;
    position: relative; /* Importante para o posicionamento dos filhos */
    border-radius: 1rem;
    box-shadow: 0 5px 10px -2px rgba(0,0,0,0.3);
  }

  /* Figure - Imagem 'Antes' (fica como background-image) */
  #comparison-{{ section.id }} figure {
    background-image: url("{% if section.settings.image_before != blank %}{{ section.settings.image_before | img_url: 'master' }}{% else %}https://placehold.co/1200x900/E0E0E0/333333?text=ANTES{% endif %}");
    background-size: cover;
    background-position: center; /* Centraliza a imagem antes */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    margin: 0;
    font-size: 0; /* Remove espaço de elementos inline */
  }

  /* Divisor - Imagem 'Depois' (fica como background-image dentro do divisor) */
  #divisor-{{ section.id }} {
    background-image: url("{% if section.settings.image_after != blank %}{{ section.settings.image_after | img_url: 'master' }}{% else %}https://placehold.co/1200x900/A0A0A0/FFFFFF?text=DEPOIS{% endif %}");
    background-size: cover;
    background-position: left center; /* CRÍTICO: Mantém a imagem 'depois' alinhada à esquerda */
    position: absolute;
    top: 0;
    left: 0;
    width: 50%; /* Largura inicial, será controlada pelo JS */
    height: 100%;
    overflow: hidden; /* Garante que a imagem 'depois' seja recortada */
  }

  /* Estilos para o slider nativo */
  #slider-{{ section.id }} {
    -webkit-appearance: none;
    -moz-appearance: none;
    position: absolute; /* Posicionado sobre as imagens */
    bottom: -1rem; /* Ajuste para posicionar abaixo da comparação visual */
    left: 0%; /* Ajuste a posição horizontal */
    width: 100%;
    height: 15px; /* Altura da trilha para facilitar o clique */
    background-color: rgba(255, 255, 255, 0.1);
    outline: none;
    cursor: ew-resize;
    z-index: 10; /* Garante que o slider esteja acima das imagens */
    transform: translateY(-50%); /* Ajusta o posicionamento vertical */
  }

  /* Estilos específicos para o thumb (handle) do slider */
  #slider-{{ section.id }}::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 30px; /* Altura maior para facilitar arrastar */
    background: {{ section.settings.slider_handle_color }};
    border-radius: 0;
    cursor: grab;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    border: 2px solid {{ section.settings.slider_line_color }}; /* Para simular a linha do slider */
    margin-top: -8px; /* Ajusta a posição vertical do thumb */
  }

  #slider-{{ section.id }}::-moz-range-thumb {
    -moz-appearance: none;
    width: 20px;
    height: 30px;
    background: {{ section.settings.slider_handle_color }};
    border-radius: 0;
    cursor: grab;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    border: 2px solid {{ section.settings.slider_line_color }};
  }

  /* Estilos para a trilha do slider */
  #slider-{{ section.id }}::-webkit-slider-runnable-track {
    background: rgba(255, 255, 255, 0.2);
    height: 4px; /* Linha mais fina */
    border-radius: 2px;
  }

  #slider-{{ section.id }}::-moz-range-track {
    background: rgba(255, 255, 255, 0.2);
    height: 4px;
    border-radius: 2px;
  }

  #slider-{{ section.id }}:focus::-webkit-slider-thumb {
    background: rgba(255, 255, 255, 0.7);
  }
  #slider-{{ section.id }}:focus::-moz-range-thumb {
    background: rgba(255, 255, 255, 0.7);
  }

  /* Ajustes responsivos */
  @media (max-width: 768px) {
    .image-comparison-background-slider-heading-{{ section.id }} {
      font-size: 2rem;
    }
    #slider-{{ section.id }} {
      bottom: -0.5rem;
    }
    #slider-{{ section.id }}::-webkit-slider-thumb,
    #slider-{{ section.id }}::-moz-range-thumb {
      width: 15px;
      height: 25px;
    }
  }
</style>

<section class="section-image-comparison-background-slider-{{ section.id }}">
  {% if section.settings.heading != blank %}
    <h2 class="image-comparison-background-slider-heading-{{ section.id }}">{{ section.settings.heading }}</h2>
  {% endif %}

  <div id="comparison-{{ section.id }}">
    <figure>
      <div id="divisor-{{ section.id }}"></div>
    </figure>
    <input type="range" min="0" max="100" value="{{ section.settings.initial_slider_position }}" id="slider-{{ section.id }}" aria-label="Slider de comparação de imagens">
  </div>
</section>

<script>
  // Script para a seção {{ section.id }}
  document.addEventListener('DOMContentLoaded', function() {
    const sectionId = '{{ section.id }}';
    const divisor = document.getElementById(`divisor-${sectionId}`);
    const slider = document.getElementById(`slider-${sectionId}`);
    const comparisonContainer = document.getElementById(`comparison-${sectionId}`);

    // Adiciona logs para depuração
    console.log(`[Background Slider ${sectionId}] Inicializando...`);
    console.log(`[Background Slider ${sectionId}] Divisor:`, divisor);
    console.log(`[Background Slider ${sectionId}] Slider Input:`, slider);
    console.log(`[Background Slider ${sectionId}] Comparison Container:`, comparisonContainer);

    if (!divisor || !slider || !comparisonContainer) {
      console.error(`[Background Slider ${sectionId}] ERRO: Um ou mais elementos essenciais não foram encontrados. O slider não funcionará.`);
      return;
    }

    function moveDivisor() {
      // O valor do slider (0-100) é diretamente a largura do divisor em porcentagem
      divisor.style.width = slider.value + "%";
      console.log(`[Background Slider ${sectionId}] Slider Value: ${slider.value}%, Divisor Width: ${divisor.style.width}`);
    }

    // Atribui o evento 'input' ao slider
    slider.addEventListener('input', moveDivisor);

    // Define a posição inicial do slider ao carregar e redimensionar
    function setInitialPosition() {
        // Dispara o evento 'input' para garantir que a posição inicial seja aplicada
        // Isto é importante para o editor de temas e carregamento inicial
        slider.dispatchEvent(new Event('input'));
        console.log(`[Background Slider ${sectionId}] Posição inicial aplicada: ${slider.value}%`);
    }

    window.addEventListener('load', setInitialPosition);
    window.addEventListener('resize', setInitialPosition);

    // Chama a função uma vez para garantir o estado inicial correto (para o editor de temas)
    setInitialPosition();
  });
</script>

{% schema %}
{
  "name": "Comparação de Imagens",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Título da Seção",
      "default": "Veja a Diferença!"
    },
    {
      "type": "image_picker",
      "id": "image_before",
      "label": "Imagem 'Antes'",
      "info": "A imagem que ficará no fundo."
    },
    {
      "type": "image_picker",
      "id": "image_after",
      "label": "Imagem 'Depois'",
      "info": "A imagem que será revelada pelo slider."
    },
    {
      "type": "range",
      "id": "initial_slider_position",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Posição Inicial do Slider",
      "default": 50,
      "info": "Define a posição inicial do slider em porcentagem."
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 300,
      "max": 1600,
      "step": 50,
      "unit": "px",
      "label": "Largura Máxima do Slider",
      "default": 900,
      "info": "Largura máxima do container de comparação de imagens."
    },
    {
      "type": "range",
      "id": "aspect_ratio",
      "min": 0.5,
      "max": 2.0,
      "step": 0.1,
      "label": "Proporção da Imagem (Largura/Altura)",
      "default": 1.3,
      "info": "Define a proporção do container (Largura / Altura, ex: 1.3 para 4:3, 1.77 para 16:9). Ajuste para a proporção das suas imagens para evitar distorção."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Cor de Fundo da Seção",
      "default": "#f5f5f7"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Cor do Título da Seção",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "slider_line_color",
      "label": "Cor da Linha do Slider (Borda do Handle)",
      "default": "#007aff"
    },
    {
      "type": "color",
      "id": "slider_handle_color",
      "label": "Cor do Handle do Slider",
      "default": "#007aff"
    }
  ],
  "presets": [
    {
      "name": "Comparação de Imagens (Slider de Fundo)",
      "category": "Imagens e Vídeos"
    }
  ]
}
{% endschema %}
