<div class="before-after-slider" style="width:100%; height:600px; position:relative;">
  <div class="wrapper" style="width:900px; height:600px; position:absolute; left:50%; top:50%; transform:translate(-50%, -50%); overflow:hidden; box-shadow:0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);">
    
    <div class="before" style="width:100%; height:100%; position:absolute; top:0; left:0; overflow:hidden; pointer-events:none;">
      <img class="content-image" src="{{ settings.imagem_antes | img_url: 'master' }}" draggable="false" style="height:100%;" />
    </div>
    
    <div class="after" style="width:125px; height:100%; position:absolute; top:0; left:0; overflow:hidden; pointer-events:none;">
      <img class="content-image" src="{{ settings.imagem_depois | img_url: 'master' }}" draggable="false" style="height:100%;" />
    </div>
    
    <div class="scroller" style="width:50px; height:50px; position:absolute; left:100px; top:50%; transform:translateY(-50%); border-radius:50%; border:5px solid #fff; background-color:transparent; opacity:0.9; cursor:pointer;">
      <svg class="scroller__thumb" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
        <polygon points="0 50 37 68 37 32 0 50" style="fill:#fff"></polygon>
        <polygon points="100 50 64 32 64 68 100 50" style="fill:#fff"></polygon>
      </svg>
    </div>
  </div>
</div>

<script>
  let active = false;

  const wrapper = document.querySelector('.before-after-slider .wrapper');
  const after = wrapper.querySelector('.after');
  const scroller = wrapper.querySelector('.scroller');

  scroller.addEventListener('mousedown', function(){
    active = true;
    scroller.classList.add('scrolling');
  });

  document.body.addEventListener('mouseup', function(){
    active = false;
    scroller.classList.remove('scrolling');
  });

  document.body.addEventListener('mouseleave', function(){
    active = false;
    scroller.classList.remove('scrolling');
  });

  document.body.addEventListener('mousemove', function(e){
    if (!active) return;
    let x = e.pageX - wrapper.getBoundingClientRect().left;
    scrollIt(x);
  });

  function scrollIt(x){
    let transform = Math.max(0, Math.min(x, wrapper.offsetWidth));
    after.style.width = transform + "px";
    scroller.style.left = (transform - 25) + "px";
  }

  scrollIt(150);

  scroller.addEventListener('touchstart', function(){
    active = true;
    scroller.classList.add('scrolling');
  });

  document.body.addEventListener('touchend', function(){
    active = false;
    scroller.classList.remove('scrolling');
  });

  document.body.addEventListener('touchcancel', function(){
    active = false;
    scroller.classList.remove('scrolling');
  });
</script>

{% schema %}
{
  "name": "Comparador de Imagens",
  "settings": [
    {
      "type": "image_picker",
      "id": "imagem_antes",
      "label": "Imagem Antes"
    },
    {
      "type": "image_picker",
      "id": "imagem_depois",
      "label": "Imagem Depois"
    }
  ],
  "presets": [
    {
      "name": "Comparador de Imagens"
    }
  ]
}
{% endschema %}
