{% schema %}
{
  "name": "Stories Custom",
  "tag": "section",
  "class": "section-stories",
  "settings": [],
  "presets": [
    {
      "name": "Stories"
    }
  ]
}
{% endschema %}

<div class="custom-stories-carousel">
  {% assign stories = shop.metaobjects.stories.values | sort: "title" %}

  {% if stories.size > 0 %}
    <div class="stories-wrapper">
      {% for story in stories %}
        <a href="{{ story.link }}" 
           class="story-item" 
           data-index="{{ forloop.index0 }}" 
           data-duration="15000" 
           tabindex="0" 
           aria-label="Abrir story {{ story.title | escape }}"
           {% if story.imagem %}
             data-image="{{ story.imagem | image_url: width: 800 }}"
           {% elsif story.video %}
             data-video="{{ story.video }}"
           {% endif %}
        >
          {% if story.imagem %}
            <div class="story-avatar-gradient">
              <img 
                src="{{ story.imagem | image_url: width: 80, height: 80 }}" 
                alt="{{ story.title | escape }}" 
                loading="lazy" 
                width="80" 
                height="80"
              />
            </div> 
          {% elsif story.video %}
            <div class="story-avatar-gradient"> 
              <video 
                src="{{ story.video }}" 
                loading="lazy" 
                width="80" 
                height="80" 
                muted
                playsinline
                preload="metadata"
              ></video>
            </div>
          {% endif %}
          <span class="story-title">{{ story.title }}</span>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-stories">Nenhum story dispon√≠vel no momento.</p>
  {% endif %}
</div>

<!-- Modal para stories -->
<div id="story-modal" class="story-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="story-modal-title">
  <div class="story-modal-content">
    <button id="close-modal" class="close-modal" aria-label="Fechar modal">√ó</button>
    
    <!-- Miniatura e nome da loja -->
    <div class="story-header">
      <img height="20" width="20" src="{{ 'mini.jpg' | asset_url }}" alt="Amaterasu Company Logo" class="story-store-logo" />
      <span class="story-store-name">Amaterasu Company</span>
    </div>

    <!-- Barra de progresso -->
    <div class="story-progress-bar">
      <div id="progress-fill"></div>
    </div>

    <div id="story-media"></div>

    <h2 id="story-modal-title"></h2>

    <!-- Curtida e visualiza√ß√µes -->
    <div class="story-footer">
      <button id="like-btn" aria-label="Curtir story">‚ô° <span id="like-count">0</span></button>
      <span id="view-count" aria-label="N√∫mero de visualiza√ß√µes">üëÅÔ∏è 0</span>
    </div>
  </div>
</div>

{{ 'stories.css' | asset_url | stylesheet_tag }}
{{ 'stories.js' | asset_url | script_tag }}
