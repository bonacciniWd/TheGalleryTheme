{% schema %}
  {
    "name": "Stories Custom",
    "tag": "section",
    "class": "section-stories",
    "settings": [
      {
        "type": "image_picker",
        "id": "store_logo",
        "label": "Logo da Loja no Modal",
        "info": "Selecione a imagem do logo da sua loja para o modal de stories."
      },
      {
        "type": "text",
        "id": "store_name",
        "label": "Nome da Loja no Modal",
        "default": "Sua Loja",
        "info": "Define o nome da loja exibido no modal de stories."
      }
    ],
    "presets": [
      {
        "name": "Stories"
      }
    ]
  }
  {% endschema %}
  <div class="custom-stories-carousel">
Â  {% assign stories = shop.metaobjects.stories.values | sort: "title" %}

Â  {# NOVO DEBUG: Verifique se a lista 'stories' nÃ£o estÃ¡ vazia #}
Â  <script>
Â  Â  console.log("LIQUID DEBUG - Array de Stories:", {{ stories | json }});
Â  </script>

Â  {% if stories.size > 0 %}
Â  Â  <div class="stories-wrapper">
Â  Â  Â  {% for story in stories %}
Â  Â  Â  Â  {% comment %} Define um ID para a histÃ³ria. Prefere o handle se existir, senÃ£o usa o Ã­ndice. {% endcomment %}
Â  Â  Â  Â  {% assign story_id_for_url = story.handle | default: forloop.index0 %}

Â  Â  Â  Â  <a href="{{ story.link.url }}"
Â  Â  Â  Â  Â  Â class="story-item"
Â  Â  Â  Â  Â  Â data-index="{{ forloop.index0 }}"
Â  Â  Â  Â  Â  Â data-duration="15000"
Â  Â  Â  Â  Â  Â tabindex="0"
Â  Â  Â  Â  Â  Â aria-label="Abrir story {{ story.title | escape }}"
Â  Â  Â  Â  Â  Â {% if story.imagem %}
Â  Â  Â  Â  Â  Â  Â data-image="{{ story.imagem | image_url: width: 800 }}"
Â  Â  Â  Â  Â  Â {% elsif story.video %}
Â  Â  Â  Â  Â  Â  Â data-video="{{ story.video }}"
Â  Â  Â  Â  Â  Â {% endif %}
Â  Â  Â  Â  Â  Â data-story-id-url="{{ story_id_for_url }}" {# ID para controle interno da URL e abertura do modal #}
Â  Â  Â  Â  Â  Â  data-external-link="{{ story.link.url }}"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  {# DEBUG DO LIQUID DENTRO DO LOOP - MANTENHA ISSO AQUI #}
Â  Â  Â  Â  Â  <script>
Â  Â  Â  Â  Â  Â  console.log("LIQUID DEBUG (dentro do loop) - story.title:", {{ story.title | json }});
Â  Â  Â  Â  Â  Â  console.log("LIQUID DEBUG (dentro do loop) - story.link:", {{ story.link | json }});
Â  Â  Â  Â  Â  Â  console.log("LIQUID DEBUG (dentro do loop) - story.link.url:", {{ story.link.url | json }});
Â  Â  Â  Â  Â  </script>
Â  Â  Â  Â  Â  {# FIM DAS LINHAS DE DEPURACAO LIQUID #}

Â  Â  Â  Â  Â  {% if story.imagem %}
Â  Â  Â  Â  Â  Â  <div class="story-avatar-gradient">
Â  Â  Â  Â  Â  Â  Â  <img
Â  Â  Â  Â  Â  Â  Â  Â  src="{{ story.imagem | image_url: width: 80, height: 80 }}"
Â  Â  Â  Â  Â  Â  Â  Â  alt="{{ story.title | escape }}"
Â  Â  Â  Â  Â  Â  Â  Â  loading="lazy"
Â  Â  Â  Â  Â  Â  Â  Â  width="80"
Â  Â  Â  Â  Â  Â  Â  Â  height="80"
Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  {% elsif story.video %}
Â  Â  Â  Â  Â  Â  <div class="story-avatar-gradient">
Â  Â  Â  Â  Â  Â  Â  <video
Â  Â  Â  Â  Â  Â  Â  Â  src="{{ story.video }}"
Â  Â  Â  Â  Â  Â  Â  Â  loading="lazy"
Â  Â  Â  Â  Â  Â  Â  Â  width="80"
Â  Â  Â  Â  Â  Â  Â  Â  height="80"
Â  Â  Â  Â  Â  Â  Â  Â  muted
Â  Â  Â  Â  Â  Â  Â  Â  playsinline
Â  Â  Â  Â  Â  Â  Â  Â  preload="metadata"
Â  Â  Â  Â  Â  Â  Â  ></video>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  <span class="story-title">{{ story.title }}</span>
Â  Â  Â  Â  </a>
Â  Â  Â  {% endfor %}
Â  Â  </div>
Â  {% else %}
Â  Â  <p class="no-stories">Nenhum story disponÃ­vel no momento.</p>
Â  {% endif %}
</div>

<div id="story-modal" class="story-modal" role="dialog" aria-modal="true" aria-labelledby="story-modal-title">
Â  <div class="story-modal-content">
Â  Â  <button id="close-modal" class="close-modal" aria-label="Fechar modal">Ã—</button>
Â  Â  <div class="story-header">
Â  Â  Â  {% if section.settings.store_logo != blank %}
Â  Â  Â  Â  <div class="story-store-logo-wrapper">
Â  Â  Â  Â  Â  <img height="40" width="40" src="{{ section.settings.store_logo | image_url: width: 40 }}" alt="{{ section.settings.store_name | escape }} Logo" class="story-store-logo" />
Â  Â  Â  Â  </div>
Â  Â  Â  {% else %}
Â  Â  Â  Â  <span class="story-store-logo-placeholder"></span>
Â  Â  Â  {% endif %}
Â  Â  Â  <span class="story-store-name">{{ section.settings.store_name }}</span>
Â  Â  </div>

Â  Â  <div class="story-progress-bar">
Â  Â  Â  <div id="progress-fill"></div>
Â  Â  </div>

Â  Â  <button id="prev-story-btn" class="story-nav-btn story-nav-btn--prev" aria-label="Story anterior" style="display:none;">&#10094;</button>
Â  Â  <button id="next-story-btn" class="story-nav-btn story-nav-btn--next" aria-label="PrÃ³xima story" style="display:none;">&#10095;</button>

Â  Â  <div id="story-media"></div>

Â  Â  <h2 id="story-modal-title" class="visually-hidden"></h2>

Â  Â  <div class="story-footer">
Â  Â  Â  <div class="story-stats-left">
Â  Â  Â  Â  <button id="share-btn" aria-label="Compartilhar story">
Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
Â  Â  Â  Â  Â  <span class="share-text">Compartilhar</span>
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <span id="view-count" aria-label="NÃºmero de visualizaÃ§Ãµes">ğŸ‘ï¸ 0</span>
Â  Â  Â  </div>
Â  Â  Â  <button id="like-btn" aria-label="Curtir story">â™¡ <span id="like-count">0</span></button>
Â  Â  </div>
Â  </div>
</div>

{# Share Modal HTML #}
<div id="share-modal" class="share-modal" role="dialog" aria-modal="true" aria-labelledby="share-modal-title" style="display: none;">
Â  <div class="share-modal-content">
Â  Â  <button id="close-share-modal" class="close-modal" aria-label="Fechar modal de compartilhamento">Ã—</button>
Â  Â  <h3 id="share-modal-title">Compartilhar Story</h3>
Â  Â  <div class="share-options">
Â  Â  Â  <a href="#" id="whatsapp-share" target="_blank" rel="noopener noreferrer" class="share-option">
Â  Â  Â  Â  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" width="40" height="40">
Â  Â  Â  Â  <span>WhatsApp</span>
Â  Â  Â  </a>
Â  Â  Â  <a href="#" id="instagram-share" target="_blank" rel="noopener noreferrer" class="share-option instagram-share-option">
Â  Â  Â  Â  <img src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" alt="Instagram" width="40" height="40">
Â  Â  Â  Â  <span>Instagram</span>
Â  Â  Â  Â  <span class="instagram-note">(Copiar link)</span>
Â  Â  Â  </a>
Â  Â  Â  <button id="copy-link-share" class="share-option">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
Â  Â  Â  Â  <span>Copiar Link</span>
Â  Â  Â  </button>
Â  Â  </div>
Â  Â  <div id="copy-feedback" class="copy-feedback" style="display:none;">Link copiado!</div>
Â  </div>
</div>

{{ 'stories.css' | asset_url | stylesheet_tag }}
{{ 'stories.js' | asset_url | script_tag }}