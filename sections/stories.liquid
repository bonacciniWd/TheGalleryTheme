{% schema %}
{
  "name": "Stories Custom",
  "tag": "section",
  "class": "section-stories",
  "settings": [
    {
      "type": "image_picker",
      "id": "store_logo",
      "label": "Logo da Loja no Modal",
      "info": "Selecione a imagem do logo da sua loja para o modal de stories."
    },
    {
      "type": "text",
      "id": "store_name",
      "label": "Nome da Loja no Modal",
      "default": "Sua Loja",
      "info": "Define o nome da loja exibido no modal de stories."
    }
  ],
  "presets": [
    {
      "name": "Stories"
    }
  ]
}
{% endschema %}

<div class="custom-stories-carousel">
  {% assign stories = shop.metaobjects.stories.values | sort: "title" %}

  {% if stories.size > 0 %}
    <div class="stories-wrapper">
      {% for story in stories %}
        <a href="{{ story.link }}"
           class="story-item"
           data-index="{{ forloop.index0 }}"
           data-duration="15000"
           tabindex="0"
           aria-label="Abrir story {{ story.title | escape }}"
           {% if story.imagem %}
             data-image="{{ story.imagem | image_url: width: 800 }}"
           {% elsif story.video %}
             data-video="{{ story.video }}"
           {% endif %}
        >
          {% if story.imagem %}
            <div class="story-avatar-gradient">
              <img
                src="{{ story.imagem | image_url: width: 80, height: 80 }}"
                alt="{{ story.title | escape }}"
                loading="lazy"
                width="80"
                height="80"
              />
            </div>
          {% elsif story.video %}
            <div class="story-avatar-gradient">
              <video
                src="{{ story.video }}"
                loading="lazy"
                width="80"
                height="80"
                muted
                playsinline
                preload="metadata"
              ></video>
            </div>
          {% endif %}
          <span class="story-title">{{ story.title }}</span>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-stories">Nenhum story dispon√≠vel no momento.</p>
  {% endif %}
</div>

<div id="story-modal" class="story-modal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="story-modal-title">
  <div class="story-modal-content">
    <button id="close-modal" class="close-modal" aria-label="Fechar modal">√ó</button>

    <div class="story-header">
      {% if section.settings.store_logo != blank %}
        <img height="40" width="40" src="{{ section.settings.store_logo | image_url: width: 40 }}" alt="{{ section.settings.store_name | escape }} Logo" class="story-store-logo" />
      {% else %}
        <span class="story-store-logo-placeholder"></span>
      {% endif %}
      <span class="story-store-name">{{ section.settings.store_name }}</span>
    </div>

    <div class="story-progress-bar">
      <div id="progress-fill"></div>
    </div>

    <div id="story-media"></div>

    <h2 id="story-modal-title" class="visually-hidden"></h2>

    <div class="story-footer">
      <button id="like-btn" aria-label="Curtir story">‚ô° <span id="like-count">0</span></button>
      <span id="view-count" aria-label="N√∫mero de visualiza√ß√µes">üëÅÔ∏è 0</span>
    </div>
  </div>
</div>

{{ 'stories.css' | asset_url | stylesheet_tag }}
{{ 'stories.js' | asset_url | script_tag }}