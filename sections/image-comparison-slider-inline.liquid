{% comment %}
  Seção de Comparação de Imagens com Slider
  TODO: Este código inclui HTML, CSS e JavaScript inline no mesmo arquivo Liquid.
  É uma solução completa para o slider de comparação de imagens, configurável via Shopify.
{% endcomment %}

<style>
  /* Estilos CSS para o slider de comparação */
  /* NOTA: Todos os IDs e classes são únicos por seção usando section.id para evitar conflitos */

  .section-image-comparison-inline-{{ section.id }} {
    position: relative;
    width: 100%;
    max-width: {{ section.settings.max_width }}px;
    margin: 2rem auto; /* Centraliza a seção e adiciona margem */
    background-color: {{ section.settings.background_color }};
    padding: 2rem 0;
    box-sizing: border-box;
    font-family: sans-serif; /* Use a fonte padrão do seu tema se houver uma */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* Título da seção (opcional) */
  .image-comparison-inline-heading-{{ section.id }} {
    color: {{ section.settings.text_color }};
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  /* Container principal da comparação */
  #comparison-{{ section.id }} {
    width: 100%;
    /* Calcula a altura com base no aspect ratio para imagens responsivas */
    padding-top: {{ 100 | divided_by: section.settings.aspect_ratio }}%;
    max-width: {{ section.settings.max_width }}px;
    overflow: hidden;
    position: relative;
    border-radius: 1rem;
    box-shadow: 0 5px 10px -2px rgba(0,0,0,0.3);
  }

  /* Figure - Imagem 'Antes' (background-image) */
  #comparison-{{ section.id }} figure {
    background-image: url("{% if section.settings.image_before != blank %}{{ section.settings.image_before | img_url: 'master' }}{% else %}https://placehold.co/1200x900/E0E0E0/333333?text=ANTES{% endif %}");
    background-size: cover;
    background-position: center; /* Centraliza a imagem 'antes' */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    margin: 0;
    font-size: 0;
    z-index: 1; /* Garante que a imagem 'antes' esteja no fundo */
  }

  /* Divisor - Imagem 'Depois' (background-image dentro do divisor) */
  #divisor-{{ section.id }} {
    background-image: url("{% if section.settings.image_after != blank %}{{ section.settings.image_after | img_url: 'master' }}{% else %}https://placehold.co/1200x900/A0A0A0/FFFFFF?text=DEPOIS{% endif %}");
    background-size: cover;
    background-position: left center; /* CRÍTICO: Mantém a imagem 'depois' alinhada à esquerda */
    position: absolute;
    top: 0;
    left: 0;
    width: 50%; /* Largura inicial, será controlada pelo JS */
    height: 100%;
    overflow: hidden;
    z-index: 2; /* Garante que o divisor esteja acima da imagem 'antes' */
  }

  /* Estilos para o slider nativo (input type="range") */
  #slider-{{ section.id }} {
    -webkit-appearance: none;
    -moz-appearance: none;
    position: absolute;
    bottom: -1rem; /* Posiciona abaixo da comparação visual */
    left: 0%;
    width: 100%;
    height: 15px; /* Altura da trilha para facilitar o clique */
    background-color: rgba(255, 255, 255, 0.1);
    outline: none;
    cursor: ew-resize;
    z-index: 10; /* Garante que o slider esteja acima das imagens */
    transform: translateY(-50%); /* Ajusta o posicionamento vertical */
  }

  /* Estilos específicos para o thumb (handle) do slider */
  #slider-{{ section.id }}::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 30px; /* Altura maior para facilitar arrastar */
    background: {{ section.settings.slider_handle_color }};
    border-radius: 0;
    cursor: grab;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    border: 2px solid {{ section.settings.slider_line_color }}; /* Para simular a linha do slider */
    margin-top: -8px; /* Ajusta a posição vertical do thumb */
  }

  #slider-{{ section.id }}::-moz-range-thumb {
    -moz-appearance: none;
    width: 20px;
    height: 30px;
    background: {{ section.settings.slider_handle_color }};
    border-radius: 0;
    cursor: grab;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    border: 2px solid {{ section.settings.slider_line_color }};
  }

  /* Estilos para a trilha do slider */
  #slider-{{ section.id }}::-webkit-slider-runnable-track {
    background: rgba(255, 255, 255, 0.2);
    height: 4px;
    border-radius: 2px;
  }

  #slider-{{ section.id }}::-moz-range-track {
    background: rgba(255, 255, 255, 0.2);
    height: 4px;
    border-radius: 2px;
  }

  #slider-{{ section.id }}:focus::-webkit-slider-thumb {
    background: rgba(255, 255, 255, 0.7);
  }
  #slider-{{ section.id }}:focus::-moz-range-thumb {
    background: rgba(255, 255, 255, 0.7);
  }

  /* Ajustes responsivos */
  @media (max-width: 768px) {
    .image-comparison-inline-heading-{{ section.id }} {
      font-size: 2rem;
    }
    #slider-{{ section.id }} {
      bottom: -0.5rem;
    }
    #slider-{{ section.id }}::-webkit-slider-thumb,
    #slider-{{ section.id }}::-moz-range-thumb {
      width: 15px;
      height: 25px;
    }
  }
</style>

<section class="section-image-comparison-inline-{{ section.id }}">
  {% if section.settings.heading != blank %}
    <h2 class="image-comparison-inline-heading-{{ section.id }}">{{ section.settings.heading }}</h2>
  {% endif %}

  <div id="comparison-{{ section.id }}">
    <figure>
      <div id="divisor-{{ section.id }}"></div>
    </figure>
    <input type="range" min="0" max="100" value="{{ section.settings.initial_slider_position }}" id="slider-{{ section.id }}" oninput="moveDivisor_{{ section.id }}()">
  </div>
</section>

<script>
  // Script JavaScript para o slider de comparação
  // A função é nomeada dinamicamente (ex: moveDivisor_123456789) para cada instância da seção
  function moveDivisor_{{ section.id }}() {
    const divisor = document.getElementById("divisor-{{ section.id }}");
    const slider = document.getElementById("slider-{{ section.id }}");

    if (divisor && slider) {
      divisor.style.width = slider.value + "%";
      // console.log(`[Slider Inline {{ section.id }}] Valor: ${slider.value}%, Largura Divisor: ${divisor.style.width}`); // Removido para menos logs no console
    } else {
      console.warn(`[Slider Inline {{ section.id }}] Elementos não encontrados para a seção.`);
    }
  }

  // Define a posição inicial do slider ao carregar e redimensionar
  // Isso garante que a posição inicial do slider (definida no Shopify) seja aplicada
  // e que o slider funcione corretamente mesmo após redimensionamento ou carregamento inicial.
  function initializeSlider_{{ section.id }}() {
    const slider = document.getElementById("slider-{{ section.id }}");
    if (slider) {
      // Dispara o evento 'input' para que a função moveDivisor seja chamada
      slider.dispatchEvent(new Event('input'));
    }
  }

  // Chama a inicialização quando a página é carregada e ao redimensionar
  window.addEventListener('load', initializeSlider_{{ section.id }});
  window.addEventListener('resize', initializeSlider_{{ section.id }});

  // Para garantir que funcione no editor de temas do Shopify (que pode não disparar 'load')
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeSlider_{{ section.id }});
  } else {
    initializeSlider_{{ section.id }}(); // DOMContentLoaded já disparou
  }
</script>

{% schema %}
{
  "name": "Comparsion",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Título da Seção",
      "default": "Veja a Diferença!"
    },
    {
      "type": "image_picker",
      "id": "image_before",
      "label": "Imagem 'Antes'",
      "info": "A imagem que ficará no fundo."
    },
    {
      "type": "image_picker",
      "id": "image_after",
      "label": "Imagem 'Depois'",
      "info": "A imagem que será revelada pelo slider."
    },
    {
      "type": "range",
      "id": "initial_slider_position",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Posição Inicial do Slider",
      "default": 50,
      "info": "Define a posição inicial do slider em porcentagem."
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 300,
      "max": 1600,
      "step": 50,
      "unit": "px",
      "label": "Largura Máxima do Slider",
      "default": 900,
      "info": "Largura máxima do container de comparação de imagens."
    },
    {
      "type": "range",
      "id": "aspect_ratio",
      "min": 0.5,
      "max": 2.0,
      "step": 0.1,
      "label": "Proporção da Imagem (Largura/Altura)",
      "default": 1.3,
      "info": "Define a proporção do container (Largura / Altura, ex: 1.3 para 4:3, 1.77 para 16:9). Ajuste para a proporção das suas imagens para evitar distorção."
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Cor de Fundo da Seção",
      "default": "#f5f5f7"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Cor do Título da Seção",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "slider_line_color",
      "label": "Cor da Linha do Slider (Borda do Handle)",
      "default": "#007aff"
    },
    {
      "type": "color",
      "id": "slider_handle_color",
      "label": "Cor do Handle do Slider",
      "default": "#007aff"
    }
  ],
  "presets": [
    {
      "name": "Comparação de Imagens (Inline)",
      "category": "Imagens e Vídeos"
    }
  ]
}
{% endschema %}